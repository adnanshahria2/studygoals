<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="./icons/icon-192.png" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#0a0f1a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="description" content="StudyGoals - Track your study progress and achieve your goals" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="apple-touch-icon" href="./icons/icon-192.png" />
    <title>StudyGoals</title>
    <script>
        window.onerror = function (msg, url, line, col, error) {
            var errorMsg = 'Global Error: ' + msg + '\n' + url + ':' + line + ':' + col;
            console.error(errorMsg);
            // Display on screen for user to see
            var root = document.getElementById('root');
            if (root) {
                root.innerHTML = '<div style="color:red;padding:20px;background:black;font-family:monospace;white-space:pre-wrap;word-break:break-all;z-index:9999;position:relative;">' + errorMsg + '</div>';
            }
            alert(errorMsg);
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            alert('Unhandled Promise: ' + event.reason);
        });
    </script>
    <script>
        // Diagnostic: Check if basic JS execution works
        document.addEventListener('DOMContentLoaded', function () {
            var loading = document.getElementById('loading-screen');
            if (loading) {
                loading.innerHTML += '<div style="color:lime;margin-top:20px;font-size:12px;">âœ“ Basic JS works</div>';
            }

            // Try to detect why module might fail
            setTimeout(function () {
                // If we're still on loading screen after 5 seconds, module failed
                if (document.getElementById('loading-screen')) {
                    var msg = 'Module failed to execute. Checking file...';
                    loading.innerHTML += '<div style="color:orange;margin-top:10px;font-size:10px;">' + msg + '</div>';

                    // Check if the JS file exists
                    var scripts = document.querySelectorAll('script[type="module"]');
                    if (scripts.length > 0) {
                        var src = scripts[0].src;
                        loading.innerHTML += '<div style="color:gray;margin-top:5px;font-size:8px;">Trying: ' + src + '</div>';

                        fetch(src)
                            .then(function (r) {
                                if (!r.ok) {
                                    loading.innerHTML += '<div style="color:red;">File error: ' + r.status + '</div>';
                                } else {
                                    loading.innerHTML += '<div style="color:yellow;">File exists but module crashed. Check console.</div>';
                                }
                            })
                            .catch(function (e) {
                                loading.innerHTML += '<div style="color:red;">Network error: ' + e.message + '</div>';
                            });
                    }
                }
            }, 5000);
        });
    </script>
</head>

<body>
    <div id="root">
        <div id="loading-screen"
            style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#0a0f1a;color:white;font-family:sans-serif;">
            <div style="font-size:24px;margin-bottom:10px;">StudyGoals</div>
            <div style="font-size:14px;color:#888;">Loading...</div>
            <div style="margin-top:20px;font-size:10px;color:#666;">If you see this for more than 5 seconds, clear site
                cache.</div>
        </div>
    </div>
    <script type="module" src="./src/main.tsx"></script>
</body>

</html>